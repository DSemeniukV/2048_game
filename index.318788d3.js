const e=new class{constructor(e){this.size=4,this.score=0,this.gameStatus="idle",this.board=e||this.createEmptyBoard()}createEmptyBoard(){return Array.from({length:this.size},()=>Array(this.size).fill(0))}moveLeft(){this.handleMove(this.board,!1)&&(this.addRandomTile(),this.checkGameOver())}moveRight(){this.handleMove(this.board,!0)&&(this.addRandomTile(),this.checkGameOver())}moveUp(){let e=this.transpose(this.board);this.handleMove(e,!1)&&(this.board=this.transpose(e),this.addRandomTile(),this.checkGameOver())}moveDown(){let e=this.transpose(this.board);this.handleMove(e,!0)&&(this.board=this.transpose(e),this.addRandomTile(),this.checkGameOver())}getScore(){return this.score}getState(){return this.board}getStatus(){return this.gameStatus}start(){"idle"===this.gameStatus&&(this.gameStatus="playing",this.board=this.createEmptyBoard(),this.addRandomTile(),this.addRandomTile())}restart(){this.score=0,this.gameStatus="idle",this.start()}handleMove(e,t){let s=!1;for(let r=0;r<this.size;r++){let a=[...e[r]];t&&a.reverse();let i=a.filter(e=>0!==e);for(let e=0;e<i.length-1;e++)i[e]===i[e+1]&&(i[e]*=2,this.score+=i[e],i[e+1]=0,2048===i[e]&&(this.gameStatus="win"));let o=i.filter(e=>0!==e),h=[...o,...Array(this.size-o.length).fill(0)];t&&h.reverse(),this.arraysEqual(h,e[r])||(e[r]=h,s=!0)}return s}transpose(e){return e[0].map((t,s)=>e.map(e=>e[s]))}arraysEqual(e,t){return e.every((e,s)=>e===t[s])}addRandomTile(){let e=[];for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)0===this.board[t][s]&&e.push([t,s]);if(!e.length)return;let[t,s]=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4}checkGameOver(){!(this.board.some(e=>e.includes(2048))||this.board.some(e=>e.includes(0)))&&([this.moveLeftPreview,this.moveRightPreview,this.moveUpPreview,this.moveDownPreview].some(e=>e.call(this))||(this.gameStatus="lose"))}moveLeftPreview(){return this.board.some(e=>{for(let t=0;t<e.length-1;t++)if(e[t]===e[t+1])return!0;return!1})}moveRightPreview(){return this.moveLeftPreview()}moveUpPreview(){return this.transpose(this.board).some(e=>{for(let t=0;t<e.length-1;t++)if(e[t]===e[t+1])return!0;return!1})}moveDownPreview(){return this.moveUpPreview()}},t=document.querySelectorAll(".field-cell"),s=document.querySelector(".game-score"),r=document.querySelector(".button"),a=document.querySelector(".message-start"),i=document.querySelector(".message-win"),o=document.querySelector(".message-lose");function h(){let h=e.getState().flat();t.forEach((e,t)=>{let s=h[t];e.textContent=0===s?"":s,e.className="field-cell",s&&e.classList.add(`field-cell--${s}`)}),s.textContent=e.getScore(),function(){let t=e.getStatus();a.classList.toggle("hidden","idle"!==t),i.classList.toggle("hidden","win"!==t),o.classList.toggle("hidden","lose"!==t),"playing"===t?(r.classList.replace("start","restart"),r.textContent="Restart"):(r.classList.replace("restart","start"),r.textContent="Start")}()}r.addEventListener("click",()=>{"idle"===e.getStatus()?e.start():e.restart(),h()}),document.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown();break;default:return}h()}),h();
//# sourceMappingURL=index.318788d3.js.map
